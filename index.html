<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoppborg Validator - EN 14960-1:2019</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-50">
    <div id="app" class="max-w-4xl mx-auto p-4"></div>
    
    <div id="modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="closeModal()">
        <div class="bg-white rounded-lg p-6 max-w-2xl max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
            <button onclick="closeModal()" class="float-right text-3xl text-gray-500 hover:text-gray-700">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        const app = {
            lang: 'sv', // 'sv' eller 'en'
            data: {
                // Grunduppgifter
                length: '', width: '', height: '', type: '',
                
                // H√∂jder per sida (f√∂r Annex A)
                heightA: '', heightB: '', heightC: '', heightD: '',
                useIndividualHeights: false,
                
                // Konstruktion
                platformHeight: '', wallHeight: '',
                
                // Slide
                hasSlide: '', slideHeight: '', runoutLength: '', hasStopWall: false,
                
                // Trappa/Ing√•ng
                entranceHeight: '', entranceTreadDepth: '',
                
                // F√∂rankring
                anchorA: '', anchorB: '', anchorC: '', anchorD: '', anchorAngle: '',
                
                // Lufttryck
                blowersNeeded: '', blowerPower: '', blowerTubeLength: '',
                
                // M√§rkning
                productId: '', idVisible: '', hasSafetyInstructions: false,
                manufacturerMaxUsers: '', manufacturerUserHeight: '',
                
                // S√§kerhet
                hasRopes: '', hasNetting: '', nettingMesh: '', nettingCorners: '',
                
                // Underlag
                surfaceType: '', impactAreaWidth: '',
                
                // Bilder
                images: []
            },
            result: null,
            cameraActive: false,
            stream: null
        };

        // Ber√§kningsfunktioner
        function calc() {
            const L = parseFloat(app.data.length) || 0;
            const W = parseFloat(app.data.width) || 0;
            const H = parseFloat(app.data.height) || 0;
            if (!L || !W || !H) return null;

            const calcSide = (len, height) => {
                const area = len * height;
                const F = 0.5 * 1.5 * 1.24 * 11.1 * 11.1 * area;
                const n = F / 1600;
                return Math.max(Math.ceil(n), 2);
            };

            // Anv√§nd individuella h√∂jder om aktiverat, annars generell h√∂jd
            const hA = app.data.useIndividualHeights ? (parseFloat(app.data.heightA) || H) : H;
            const hB = app.data.useIndividualHeights ? (parseFloat(app.data.heightB) || H) : H;
            const hC = app.data.useIndividualHeights ? (parseFloat(app.data.heightC) || H) : H;
            const hD = app.data.useIndividualHeights ? (parseFloat(app.data.heightD) || H) : H;

            const anchors = {
                A: { name: 'Sida A (Fram)', len: L, height: hA, need: calcSide(L, hA) },
                B: { name: 'Sida B (H√∂ger)', len: W, height: hB, need: calcSide(W, hB) },
                C: { name: 'Sida C (Bak)', len: L, height: hC, need: calcSide(L, hC) },
                D: { name: 'Sida D (V√§nster)', len: W, height: hD, need: calcSide(W, hD) }
            };

            const totalAnchors = Object.values(anchors).reduce((s, a) => s + a.need, 0);
            const minAnchors = Math.max(6, totalAnchors);
            
            const volume = L * W * H;
            const blowersNeeded = Math.ceil(volume / 100);

            // Run-out ber√§kning
            const slideH = parseFloat(app.data.slideHeight) || 0;
            const minRunout = Math.max(slideH * 0.5, 0.3);
            const runoutRequired = minRunout + (app.data.hasStopWall ? 0.5 : 0);

            // Trappdjup krav
            const platformH = parseFloat(app.data.platformHeight) || 0;
            const minTreadDepth = platformH * 1.5;

            return { 
                anchors, minAnchors, L, W, H, blowersNeeded,
                runoutRequired, minRunout, minTreadDepth
            };
        }

        function validate() {
            const c = calc();
            if (!c) {
                alert('Fyll i l√§ngd, bredd och h√∂jd f√∂rst');
                return;
            }

            const issues = [];
            
            // KRITISKA FEL
            if (app.data.hasRopes === 'yes') {
                issues.push({ 
                    severity: 'critical',
                    cat: 'S√§kerhet', 
                    msg: 'REP F√ñRBJUDET! Risk f√∂r strypning', 
                    ref: '4.1.4',
                    action: 'Ta bort alla rep omedelbart'
                });
            }

            if (!app.data.productId) {
                issues.push({ 
                    severity: 'critical',
                    cat: 'M√§rkning', 
                    msg: 'Produkt-ID saknas', 
                    ref: '8',
                    action: 'M√§rk borgen med unikt ID'
                });
            }

            if (app.data.idVisible === 'no') {
                issues.push({ 
                    severity: 'critical',
                    cat: 'M√§rkning', 
                    msg: 'ID ej synligt under anv√§ndning', 
                    ref: '8',
                    action: 'Flytta ID-m√§rkning s√• den syns'
                });
            }

            // F√∂rankring
            ['A', 'B', 'C', 'D'].forEach(side => {
                const supplied = parseInt(app.data['anchor' + side]) || 0;
                const req = c.anchors[side].need;
                if (supplied > 0 && supplied < req) {
                    issues.push({ 
                        severity: 'critical',
                        cat: `F√∂rankring / Sida ${side}`, 
                        msg: `${supplied} st < ${req} st kr√§vs`, 
                        ref: 'Annex A',
                        action: `L√§gg till ${req - supplied} f√§stpunkter`
                    });
                }
            });

            // ALLVARLIGA FEL
            const angle = parseInt(app.data.anchorAngle) || 0;
            if (angle > 0 && (angle < 30 || angle > 45)) {
                issues.push({ 
                    severity: 'serious',
                    cat: 'F√∂rankring', 
                    msg: `Vinkel ${angle}¬∞ (ska vara 30-45¬∞)`, 
                    ref: '4.2.1',
                    action: 'Justera f√∂rankringsvinkeln'
                });
            }

            // Slide run-out
            if (app.data.hasSlide === 'yes') {
                const runoutActual = parseFloat(app.data.runoutLength) || 0;
                if (runoutActual > 0 && runoutActual < c.runoutRequired) {
                    issues.push({ 
                        severity: 'critical',
                        cat: 'Slide / Run-out', 
                        msg: `${runoutActual}m < ${c.runoutRequired.toFixed(2)}m kr√§vs`, 
                        ref: '4.2.11',
                        action: `F√∂rl√§ng run-out med ${(c.runoutRequired - runoutActual).toFixed(2)}m`
                    });
                }
            }

            // Inbl√•sr√∂r - NYTT!
            const tubeLen = parseFloat(app.data.blowerTubeLength) || 0;
            if (tubeLen > 0 && tubeLen < 1.2) {
                issues.push({ 
                    severity: 'critical',
                    cat: 'Lufttryck', 
                    msg: `Inbl√•sr√∂r ${tubeLen}m < 1.2m MINIMUM`, 
                    ref: '4.2.4',
                    action: 'Byt till l√§ngre r√∂r (minst 1.4m rekommenderas starkt)'
                });
            } else if (tubeLen > 0 && tubeLen < 1.4) {
                issues.push({ 
                    severity: 'warning',
                    cat: 'Lufttryck', 
                    msg: `Inbl√•sr√∂r ${tubeLen}m < 1.4m (rekommenderat)`, 
                    ref: '4.2.4',
                    action: 'Byt till 1.4m r√∂r f√∂r optimal s√§kerhet'
                });
            }

            // Trappdjup
            const treadDepth = parseFloat(app.data.entranceTreadDepth) || 0;
            if (treadDepth > 0 && c.minTreadDepth > 0 && treadDepth < c.minTreadDepth) {
                issues.push({ 
                    severity: 'serious',
                    cat: 'Ing√•ng', 
                    msg: `Trappdjup ${treadDepth}m < ${c.minTreadDepth.toFixed(2)}m (1.5√ó plattformsh√∂jd)`, 
                    ref: '4.2.3',
                    action: 'F√∂rl√§ng trappdjupet'
                });
            }

            // VARNINGAR
            if (!app.data.hasSafetyInstructions) {
                issues.push({ 
                    severity: 'warning',
                    cat: 'M√§rkning', 
                    msg: 'S√§kerhetsinstruktion saknas', 
                    ref: '6',
                    action: 'F√§st tydliga s√§kerhetsinstruktioner'
                });
            }

            if (app.data.hasNetting === 'yes') {
                const mesh = parseFloat(app.data.nettingMesh) || 0;
                if (mesh > 8) {
                    issues.push({ 
                        severity: 'serious',
                        cat: 'N√§t', 
                        msg: `Maskstorlek ${mesh}mm > 8mm`, 
                        ref: '4.1.3',
                        action: 'Byt till n√§t med mindre maskor'
                    });
                }
                if (app.data.nettingCorners === 'no') {
                    issues.push({ 
                        severity: 'serious',
                        cat: 'N√§t', 
                        msg: 'N√§ten n√•r inte h√∂rnen', 
                        ref: '4.2.9',
                        action: 'Montera n√§t som n√•r alla h√∂rn'
                    });
                }
            }

            const blowers = parseInt(app.data.blowersNeeded) || 0;
            if (blowers > 0 && blowers < c.blowersNeeded) {
                issues.push({ 
                    severity: 'serious',
                    cat: 'Lufttryck', 
                    msg: `${blowers} fl√§ktar < ${c.blowersNeeded} kr√§vs f√∂r denna volym`, 
                    ref: '4.2.2',
                    action: `L√§gg till ${c.blowersNeeded - blowers} fl√§ktar`
                });
            }

            // Kategorisera
            const critical = issues.filter(i => i.severity === 'critical');
            const serious = issues.filter(i => i.severity === 'serious');
            const warnings = issues.filter(i => i.severity === 'warning');

            app.result = { 
                calc: c, 
                issues, 
                critical,
                serious,
                warnings,
                ok: critical.length === 0 && serious.length === 0
            };
            
            localStorage.setItem('hoppborg', JSON.stringify(app));
            render();
        }

        // √ñvers√§ttningar
        const t = {
            sv: {
                title: 'Hoppborg Validator',
                subtitle: 'Baserad p√• Konsumentverkets marknadskontroll',
                validate: '‚úì VALIDERA HOPPBORG',
                approved: '‚úì GODK√ÑND',
                failed: '‚úó UNDERK√ÑND',
                // ... fler √∂vers√§ttningar l√§ggs till vid behov
            },
            en: {
                title: 'Bouncy Castle Validator',
                subtitle: 'Based on Swedish Consumer Agency market surveillance',
                validate: '‚úì VALIDATE BOUNCY CASTLE',
                approved: '‚úì APPROVED',
                failed: '‚úó FAILED',
                // ... fler √∂vers√§ttningar l√§ggs till vid behov
            }
        };

        function tr(key) {
            return t[app.lang][key] || key;
        }

        function toggleLang() {
            app.lang = app.lang === 'sv' ? 'en' : 'sv';
            render();
        }

        // Modal functions
        function showInfo(type) {
            const m = document.getElementById('modalContent');
            
            const modals = {
                length: `
                    <h3 class="font-bold text-lg mb-3">üìè ${app.lang === 'sv' ? 'Hur m√§ter man l√§ngd?' : 'How to measure length?'}</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                        <p class="font-semibold mb-2">${app.lang === 'sv' ? '‚ö†Ô∏è VIKTIGT: L√§ngd = horisontellt m√•tt' : '‚ö†Ô∏è IMPORTANT: Length = horizontal measurement'}</p>
                        <p class="text-sm">${app.lang === 'sv' ? 'M√§t fr√•n kant till kant i l√§ngdriktningen p√• marken n√§r hoppborgen √§r uppbl√•st.' : 'Measure from edge to edge along the length on the ground when inflated.'}</p>
                    </div>
                    
                    <svg viewBox="0 0 300 150" class="w-full max-w-md border-2 rounded bg-white mb-3 mx-auto">
                        <!-- Hoppborg ovanifr√•n -->
                        <rect x="50" y="30" width="200" height="90" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                        
                        <!-- L√§ngdm√§tning -->
                        <line x1="50" y1="15" x2="250" y2="15" stroke="#f44336" stroke-width="3"/>
                        <line x1="50" y1="10" x2="50" y2="20" stroke="#f44336" stroke-width="2"/>
                        <line x1="250" y1="10" x2="250" y2="20" stroke="#f44336" stroke-width="2"/>
                        <text x="150" y="12" text-anchor="middle" font-size="12" fill="#f44336" font-weight="bold">L√ÑNGD / LENGTH</text>
                        
                        <!-- F√§stpunkter -->
                        <circle cx="50" cy="30" r="4" fill="#4caf50"/>
                        <circle cx="250" cy="30" r="4" fill="#4caf50"/>
                        <circle cx="50" cy="120" r="4" fill="#4caf50"/>
                        <circle cx="250" cy="120" r="4" fill="#4caf50"/>
                        
                        <text x="150" y="80" text-anchor="middle" font-size="14" font-weight="bold">HOPPBORG</text>
                        <text x="150" y="95" text-anchor="middle" font-size="10">${app.lang === 'sv' ? '(ovanifr√•n)' : '(top view)'}</text>
                    </svg>
                    
                    <div class="space-y-2 text-sm">
                        <p class="bg-green-50 p-2 rounded border-l-4 border-green-500">
                            <strong class="text-green-700">‚úì ${app.lang === 'sv' ? 'R√§tt' : 'Correct'}:</strong> ${app.lang === 'sv' ? 'M√§t p√• markniv√• mellan ytterkanterna' : 'Measure at ground level between outer edges'}
                        </p>
                        <p class="bg-red-50 p-2 rounded border-l-4 border-red-500">
                            <strong class="text-red-700">‚úó ${app.lang === 'sv' ? 'Fel' : 'Wrong'}:</strong> ${app.lang === 'sv' ? 'M√§t inte diagonalt eller i luften' : 'Do not measure diagonally or in the air'}
                        </p>
                    </div>
                `,
                
                width: `
                    <h3 class="font-bold text-lg mb-3">üìè ${app.lang === 'sv' ? 'Hur m√§ter man bredd?' : 'How to measure width?'}</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                        <p class="font-semibold mb-2">${app.lang === 'sv' ? '‚ö†Ô∏è VIKTIGT: Bredd = horisontellt m√•tt tv√§rs √∂ver' : '‚ö†Ô∏è IMPORTANT: Width = horizontal measurement across'}</p>
                        <p class="text-sm">${app.lang === 'sv' ? 'M√§t fr√•n kant till kant i tv√§rriktningen p√• marken n√§r hoppborgen √§r uppbl√•st.' : 'Measure from edge to edge across the width on the ground when inflated.'}</p>
                    </div>
                    
                    <svg viewBox="0 0 300 150" class="w-full max-w-md border-2 rounded bg-white mb-3 mx-auto">
                        <!-- Hoppborg ovanifr√•n -->
                        <rect x="50" y="30" width="200" height="90" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                        
                        <!-- Breddm√§tning -->
                        <line x1="265" y1="30" x2="265" y2="120" stroke="#ff9800" stroke-width="3"/>
                        <line x1="260" y1="30" x2="270" y2="30" stroke="#ff9800" stroke-width="2"/>
                        <line x1="260" y1="120" x2="270" y2="120" stroke="#ff9800" stroke-width="2"/>
                        <text x="280" y="75" font-size="12" fill="#ff9800" font-weight="bold">B</text>
                        <text x="280" y="87" font-size="12" fill="#ff9800" font-weight="bold">R</text>
                        <text x="280" y="99" font-size="12" fill="#ff9800" font-weight="bold">E</text>
                        <text x="280" y="111" font-size="12" fill="#ff9800" font-weight="bold">D</text>
                        <text x="280" y="123" font-size="12" fill="#ff9800" font-weight="bold">D</text>
                        
                        <!-- F√§stpunkter -->
                        <circle cx="50" cy="30" r="4" fill="#4caf50"/>
                        <circle cx="250" cy="30" r="4" fill="#4caf50"/>
                        <circle cx="50" cy="120" r="4" fill="#4caf50"/>
                        <circle cx="250" cy="120" r="4" fill="#4caf50"/>
                        
                        <text x="150" y="80" text-anchor="middle" font-size="14" font-weight="bold">HOPPBORG</text>
                    </svg>
                    
                    <div class="space-y-2 text-sm">
                        <p class="bg-green-50 p-2 rounded border-l-4 border-green-500">
                            <strong class="text-green-700">‚úì ${app.lang === 'sv' ? 'R√§tt' : 'Correct'}:</strong> ${app.lang === 'sv' ? 'M√§t vinkelr√§tt mot l√§ngdriktningen' : 'Measure perpendicular to the length'}
                        </p>
                    </div>
                `,
                
                height: `
                    <h3 class="font-bold text-lg mb-3">üìè ${app.lang === 'sv' ? 'Hur m√§ter man h√∂jd?' : 'How to measure height?'}</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                        <p class="font-semibold mb-2">${app.lang === 'sv' ? '‚ö†Ô∏è VIKTIGT: H√∂jd = v√§ggarnas h√∂jd' : '‚ö†Ô∏è IMPORTANT: Height = wall height'}</p>
                        <p class="text-sm">${app.lang === 'sv' ? 'M√§t fr√•n marken till d√§r v√§ggarna slutar - INTE till dekorationer p√• taket!' : 'Measure from ground to where walls end - NOT to roof decorations!'}</p>
                    </div>
                    
                    <svg viewBox="0 0 200 150" class="w-full max-w-xs border-2 rounded bg-white mb-3 mx-auto">
                        <rect x="20" y="80" width="160" height="60" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                        <line x1="20" y1="140" x2="180" y2="140" stroke="#000" stroke-width="2"/>
                        <text x="100" y="155" text-anchor="middle" font-size="10" font-weight="bold">${app.lang === 'sv' ? 'MARK' : 'GROUND'}</text>
                        
                        <!-- H√∂jdm√§tning -->
                        <line x1="10" y1="80" x2="10" y2="140" stroke="#f44336" stroke-width="3"/>
                        <line x1="5" y1="80" x2="15" y2="80" stroke="#f44336" stroke-width="2"/>
                        <line x1="5" y1="140" x2="15" y2="140" stroke="#f44336" stroke-width="2"/>
                        <text x="5" y="110" font-size="16" fill="#f44336" font-weight="bold">H</text>
                        
                        <!-- Dekor p√• taket (r√§knas EJ) -->
                        <circle cx="100" cy="50" r="20" fill="#ffd700" opacity="0.3"/>
                        <line x1="90" y1="50" x2="110" y2="50" stroke="#666" stroke-width="2"/>
                        <line x1="100" y1="40" x2="100" y2="60" stroke="#666" stroke-width="2"/>
                        <text x="100" y="45" text-anchor="middle" font-size="8">${app.lang === 'sv' ? 'Dekor' : 'Decor'}</text>
                        <text x="100" y="55" text-anchor="middle" font-size="7">${app.lang === 'sv' ? '(r√§knas EJ)' : '(NOT counted)'}</text>
                    </svg>
                    
                    <div class="space-y-2 text-sm">
                        <p class="bg-green-50 p-2 rounded border-l-4 border-green-500">
                            <strong class="text-green-700">‚úì ${app.lang === 'sv' ? 'R√§tt' : 'Correct'}:</strong> ${app.lang === 'sv' ? 'M√§t till v√§ggarnas √∂verkant (d√§r luften √§r)' : 'Measure to top of walls (where the air is)'}
                        </p>
                        <p class="bg-red-50 p-2 rounded border-l-4 border-red-500">
                            <strong class="text-red-700">‚úó ${app.lang === 'sv' ? 'Fel' : 'Wrong'}:</strong> ${app.lang === 'sv' ? 'Inkludera inte flaggor, antenner eller dekor p√• taket' : 'Do not include flags, antennas or roof decorations'}
                        </p>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded mt-3">
                        <p class="text-sm font-semibold mb-2">${app.lang === 'sv' ? 'üìå OBS! Olika h√∂jder:' : 'üìå NOTE! Different heights:'}</p>
                        <ul class="text-sm list-disc ml-5 space-y-1">
                            <li><strong>${app.lang === 'sv' ? 'Totalh√∂jd' : 'Total height'}</strong>: ${app.lang === 'sv' ? 'F√∂r volymsber√§kning' : 'For volume calculation'}</li>
                            <li><strong>${app.lang === 'sv' ? 'Plattformsh√∂jd' : 'Platform height'}</strong>: ${app.lang === 'sv' ? 'Fr√•n mark till lekyta' : 'From ground to play surface'}</li>
                            <li><strong>${app.lang === 'sv' ? 'V√§ggh√∂jd' : 'Wall height'}</strong>: ${app.lang === 'sv' ? 'Fr√•n lekyta till v√§ggtop (kan variera per sida!)' : 'From play surface to wall top (can vary per side!)'}</li>
                        </ul>
                    </div>
                    
                    <p class="text-xs text-gray-600 mt-3 italic">Ref: Annex A - "area of exposed surface"</p>
                `,
                
                annexA: `
                    <h3 class="font-bold text-xl mb-3">üìê Annex A: Ber√§kning av f√§stpunkter</h3>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-4">
                        <p class="font-semibold mb-2">üéØ Varf√∂r √§r detta viktigt?</p>
                        <p class="text-sm">Dessa ber√§kningar s√§kerst√§ller att hoppborgen inte bl√•ser iv√§g i stark vind. Varje sida ber√§knas separat baserat p√• dess exponerade yta mot vinden.</p>
                    </div>
                    
                    <h4 class="font-semibold mb-2">Formeln (varje sida ber√§knas separat):</h4>
                    
                    <div class="bg-gray-100 p-4 rounded font-mono text-sm mb-3">
                        <p class="mb-2">F = 0.5 √ó 1.5 √ó 1.24 √ó 11.1¬≤ √ó (l√§ngd √ó h√∂jd)</p>
                        <p class="mb-2">F = 0.5 √ó 1.5 √ó 1.24 √ó 123.21 √ó (l√§ngd √ó h√∂jd)</p>
                        <p>n = F √∑ 1,600 <span class="text-red-600 font-bold">(avrunda ALLTID UPP√ÖT)</span></p>
                    </div>
                    
                    <div class="bg-blue-50 p-3 rounded mb-3 text-sm">
                        <p class="font-semibold mb-2">‚ö†Ô∏è KRITISKA regler:</p>
                        <ul class="list-disc ml-5 space-y-1">
                            <li><strong>H√∂jd = v√§ggarnas h√∂jd</strong>, inte dekorationer</li>
                            <li><strong>H√∂rn r√§knas 50%</strong> p√• varje sida (1 h√∂rn = 0.5 + 0.5)</li>
                            <li><strong>Minimum 6 f√§stpunkter</strong> totalt f√∂r hela borgen</li>
                            <li><strong>Vid decimal: avrunda UPP√ÖT</strong> (1.1 ‚Üí 2, 2.8 ‚Üí 3)</li>
                        </ul>
                    </div>
                    
                    <div class="bg-green-50 border-2 border-green-500 p-4 rounded">
                        <p class="text-sm font-bold mb-3 text-green-800">üí° KONKRET EXEMPEL (7m √ó 5m √ó 3m h√∂g):</p>
                        
                        <div class="space-y-3 text-sm font-mono">
                            <div class="bg-white p-2 rounded">
                                <p class="font-bold">Sida A (7m l√•ng, 3m h√∂g):</p>
                                <p>F = 0.5 √ó 1.5 √ó 1.24 √ó 123.21 √ó (7 √ó 3)</p>
                                <p>F = 2,405 N</p>
                                <p>n = 2,405 √∑ 1,600 = 1.50</p>
                                <p class="text-green-600 font-bold">‚Üí 2 f√§stpunkter (rundar upp fr√•n 1.5)</p>
                                <p class="text-xs text-gray-600">Men h√∂rn = 0.5 vardera, s√• 2 + 0.5 + 0.5 = 3 p√• sidan</p>
                            </div>
                            
                            <div class="bg-white p-2 rounded">
                                <p class="font-bold">Sida B (5m l√•ng, 3m h√∂g):</p>
                                <p>F = 0.5 √ó 1.5 √ó 1.24 √ó 123.21 √ó (5 √ó 3)</p>
                                <p>F = 1,718 N</p>
                                <p>n = 1,718 √∑ 1,600 = 1.07</p>
                                <p class="text-green-600 font-bold">‚Üí 2 f√§stpunkter (rundar upp fr√•n 1.07)</p>
                            </div>
                            
                            <div class="bg-white p-2 rounded">
                                <p class="font-bold">Sida C (7m): Samma som A = 2 f√§stpunkter</p>
                                <p class="font-bold">Sida D (5m): Samma som B = 2 f√§stpunkter</p>
                            </div>
                        </div>
                        
                        <p class="mt-3 text-sm font-bold text-green-800">Totalt: 8 f√§stpunkter (√∂ver minimum 6 ‚úì)</p>
                    </div>
                    
                    <div class="bg-red-50 border-l-4 border-red-500 p-3 mt-3">
                        <p class="text-sm font-semibold">üö® Vanligt fel fr√•n kinesiska tillverkare:</p>
                        <p class="text-sm">De r√§knar ofta totalt ist√§llet f√∂r per sida, eller gl√∂mmer avrunda upp√•t!</p>
                    </div>
                `,
                
                runout: `
                    <h3 class="font-bold text-lg mb-3">üõù Run-out (ut√•kningssektion)</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-3 mb-3">
                        <p class="text-sm font-semibold">Vad √§r run-out?</p>
                        <p class="text-sm">Utbroms-zonen d√§r barnet saktar ner efter att ha √•kt ner fr√•n rutschbanan. Den m√•ste vara tillr√§ckligt l√•ng f√∂r s√§ker inbromsning.</p>
                    </div>
                    
                    <svg viewBox="0 0 300 200" class="w-full border-2 rounded bg-white mb-3">
                        <line x1="50" y1="180" x2="280" y2="180" stroke="#000" stroke-width="2"/>
                        <text x="150" y="195" text-anchor="middle" font-size="10" font-weight="bold">MARK</text>
                        
                        <!-- Slide -->
                        <path d="M 50 50 L 50 120 Q 50 150 80 160 L 200 175" fill="none" stroke="#2196f3" stroke-width="3"/>
                        <circle cx="50" cy="50" r="4" fill="#f44336"/>
                        <text x="25" y="50" font-size="10" fill="#f44336" font-weight="bold">Start</text>
                        
                        <!-- Run-out -->
                        <line x1="200" y1="175" x2="270" y2="175" stroke="#4caf50" stroke-width="4"/>
                        <text x="235" y="170" text-anchor="middle" font-size="11" fill="#4caf50" font-weight="bold">RUN-OUT</text>
                        
                        <!-- H√∂jdm√§tning -->
                        <line x1="50" y1="50" x2="50" y2="180" stroke="#f44336" stroke-width="1" stroke-dasharray="3,3"/>
                        <text x="40" y="115" font-size="12" fill="#f44336" font-weight="bold">H</text>
                        
                        <!-- L√§ngdm√§tning -->
                        <line x1="200" y1="165" x2="270" y2="165" stroke="#4caf50" stroke-width="1"/>
                        <line x1="200" y1="165" x2="200" y2="185" stroke="#4caf50" stroke-width="1"/>
                        <line x1="270" y1="165" x2="270" y2="185" stroke="#4caf50" stroke-width="1"/>
                        <text x="235" y="163" text-anchor="middle" font-size="9" fill="#4caf50">L√§ngd</text>
                    </svg>
                    
                    <div class="space-y-2 text-sm bg-blue-50 p-3 rounded mb-3">
                        <p class="font-semibold">üìè Krav enligt 4.2.11:</p>
                        <ul class="list-disc ml-5 space-y-1">
                            <li>Minsta l√§ngd: <strong>50% av slide-h√∂jd</strong> ELLER <strong>300mm</strong> (det som √§r st√∂rst)</li>
                            <li>Max lutning: <strong>10¬∞</strong></li>
                            <li>Med stoppv√§gg: l√§gg till <strong>+500mm</strong> till l√§ngden</li>
                        </ul>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded">
                        <p class="font-semibold text-sm mb-2">üí° Exempel:</p>
                        <p class="text-sm">Slide-h√∂jd: 2.0m</p>
                        <p class="text-sm">‚Üí Run-out minimum: 2.0 √ó 0.5 = <strong>1.0m</strong></p>
                        <p class="text-sm">‚Üí Med stoppv√§gg: 1.0 + 0.5 = <strong>1.5m</strong></p>
                    </div>
                `,
                
                treadDepth: `
                    <h3 class="font-bold text-lg mb-3">üö™ Trappdjup (Tread Depth)</h3>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-3 mb-3">
                        <p class="text-sm font-semibold">Vad √§r trappdjup?</p>
                        <p class="text-sm">Djupet p√• steget/rampen som leder upp till hoppborgen. Det m√•ste vara tillr√§ckligt djupt f√∂r att barn ska kunna kl√§ttra s√§kert.</p>
                    </div>
                    
                    <svg viewBox="0 0 300 200" class="w-full border-2 rounded bg-white mb-3">
                        <!-- Mark -->
                        <line x1="0" y1="180" x2="300" y2="180" stroke="#000" stroke-width="2"/>
                        
                        <!-- Plattform -->
                        <rect x="150" y="80" width="140" height="100" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                        <text x="220" y="135" text-anchor="middle" font-size="11" font-weight="bold">PLATTFORM</text>
                        
                        <!-- Trappa/Step -->
                        <rect x="50" y="130" width="100" height="50" fill="#90caf9" stroke="#1976d2" stroke-width="2"/>
                        <text x="100" y="160" text-anchor="middle" font-size="10" font-weight="bold">STEG</text>
                        
                        <!-- Plattformsh√∂jd -->
                        <line x1="20" y1="80" x2="20" y2="180" stroke="#f44336" stroke-width="2"/>
                        <line x1="15" y1="80" x2="25" y2="80" stroke="#f44336" stroke-width="2"/>
                        <line x1="15" y1="180" x2="25" y2="180" stroke="#f44336" stroke-width="2"/>
                        <text x="12" y="135" font-size="12" fill="#f44336" font-weight="bold">H</text>
                        
                        <!-- Trappdjup -->
                        <line x1="50" y1="190" x2="150" y2="190" stroke="#4caf50" stroke-width="2"/>
                        <line x1="50" y1="185" x2="50" y2="195" stroke="#4caf50" stroke-width="2"/>
                        <line x1="150" y1="185" x2="150" y2="195" stroke="#4caf50" stroke-width="2"/>
                        <text x="100" y="205" text-anchor="middle" font-size="10" fill="#4caf50" font-weight="bold">DJUP = 1.5 √ó H</text>
                    </svg>
                    
                    <div class="space-y-2 text-sm bg-blue-50 p-3 rounded mb-3">
                        <p class="font-semibold">üìè Krav enligt 4.2.3:</p>
                        <ul class="list-disc ml-5 space-y-1">
                            <li>Trappdjup ‚â• <strong>1.5 √ó plattformsh√∂jd</strong></li>
                            <li>M√§ts fr√•n hoppborgens kant till stegets/rampens kant</li>
                            <li>Steget/rampen ska t√§cka hela ing√•ngen med √∂verlapp</li>
                        </ul>
                    </div>
                    
                    <div class="bg-green-50 p-3 rounded">
                        <p class="font-semibold text-sm mb-2">üí° Exempel:</p>
                        <p class="text-sm">Plattformsh√∂jd: 0.6m</p>
                        <p class="text-sm">‚Üí Minsta trappdjup: 0.6 √ó 1.5 = <strong>0.9m (90cm)</strong></p>
                    </div>
                    
                    <div class="bg-yellow-50 p-3 rounded mt-3">
                        <p class="text-sm">‚ö†Ô∏è Detta g√§ller √§ven f√∂r ramper - m√•ste ha samma djup!</p>
                    </div>
                `,
                
                blowerTube: `
                    <h3 class="font-bold text-lg mb-3">üí® Inbl√•sr√∂r (Connection Tube)</h3>
                    
                    <div class="bg-red-50 border-l-4 border-red-500 p-3 mb-3">
                        <p class="text-sm font-semibold">üö® VIKTIGT S√ÑKERHETSKRAV!</p>
                        <p class="text-sm">Inbl√•sr√∂ret m√•ste vara tillr√§ckligt l√•ngt f√∂r att barn inte ska kunna n√• fl√§kten eller fastna.</p>
                    </div>
                    
                    <svg viewBox="0 0 400 200" class="w-full border-2 rounded bg-white mb-3">
                        <!-- Hoppborg -->
                        <rect x="280" y="60" width="100" height="120" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                        <text x="330" y="125" text-anchor="middle" font-size="11" font-weight="bold">HOPPBORG</text>
                        
                        <!-- Inbl√•sr√∂r -->
                        <rect x="140" y="110" width="140" height="30" fill="#90caf9" stroke="#1976d2" stroke-width="2"/>
                        <text x="210" y="130" text-anchor="middle" font-size="9" font-weight="bold">INBL√ÖSR√ñR</text>
                        
                        <!-- Fl√§kt -->
                        <circle cx="80" cy="125" r="40" fill="#ffeb3b" stroke="#f57c00" stroke-width="2"/>
                        <circle cx="80" cy="125" r="20" fill="#ff9800"/>
                        <text x="80" y="170" text-anchor="middle" font-size="10" font-weight="bold">FL√ÑKT</text>
                        
                        <!-- L√§ngdm√§tning MINIMUM -->
                        <line x1="120" y1="50" x2="280" y2="50" stroke="#f44336" stroke-width="2"/>
                        <line x1="120" y1="45" x2="120" y2="55" stroke="#f44336" stroke-width="2"/>
                        <line x1="280" y1="45" x2="280" y2="55" stroke="#f44336" stroke-width="2"/>
                        <text x="200" y="45" text-anchor="middle" font-size="11" fill="#f44336" font-weight="bold">MIN 1.2m</text>
                        
                        <!-- L√§ngdm√§tning REKOMMENDERAT -->
                        <line x1="120" y1="30" x2="280" y2="30" stroke="#4caf50" stroke-width="2" stroke-dasharray="5,5"/>
                        <text x="200" y="25" text-anchor="middle" font-size="11" fill="#4caf50" font-weight="bold">REKOMMENDERAT 1.4m+</text>
                    </svg>
                    
                    <div class="space-y-2 text-sm">
                        <div class="bg-red-50 p-3 rounded border-l-4 border-red-500">
                            <p class="font-semibold mb-1">‚ùå KRITISKT FEL (< 1.2m):</p>
                            <p>Fl√§kten f√∂r n√§ra hoppborgen = LIVSFARA</p>
                            <ul class="list-disc ml-5 mt-1">
                                <li>Barn kan n√• fl√§kten</li>
                                <li>Risk f√∂r fastkl√§md hand/finger</li>
                                <li>Risk f√∂r elektrisk st√∂t</li>
                            </ul>
                        </div>
                        
                        <div class="bg-yellow-50 p-3 rounded border-l-4 border-yellow-500">
                            <p class="font-semibold mb-1">‚ö†Ô∏è VARNING (1.2-1.4m):</p>
                            <p>Uppfyller kravet men marginellt - ej optimal s√§kerhet</p>
                        </div>
                        
                        <div class="bg-green-50 p-3 rounded border-l-4 border-green-500">
                            <p class="font-semibold mb-1">‚úì GODK√ÑNT (‚â• 1.4m):</p>
                            <p>Bra s√§kerhetsmarginal enligt b√§sta praxis</p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-3 rounded mt-3">
                        <p class="text-sm font-semibold">üìè Avst√•nd fr√•n v√§gg vs √∂ppen sida:</p>
                        <ul class="list-disc ml-5 text-sm">
                            <li>Fr√•n v√§gg med st√§ngd sida: minimum <strong>1.2m</strong></li>
                            <li>Fr√•n √∂ppen sida: minimum <strong>2.5m</strong></li>
                        </ul>
                        <p class="text-xs text-gray-600 mt-2">Ref: EN 14960-1:2019, sektion 4.2.4</p>
                    </div>
                `,
                
                corners: `
                    <h3 class="font-bold mb-3">${app.lang === 'sv' ? 'üï∏Ô∏è N√§t m√•ste n√• h√∂rnen' : 'üï∏Ô∏è Nets must reach corners'}</h3>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-3 mb-3">
                        <p class="text-sm font-semibold">${app.lang === 'sv' ? 'Varf√∂r √§r detta viktigt?' : 'Why is this important?'}</p>
                        <p class="text-sm">${app.lang === 'sv' ? '√ñppna h√∂rn = risk f√∂r att barn fastnar mellan v√§ggen och n√§tet, eller faller ut i h√∂rnet.' : 'Open corners = risk of children getting trapped between wall and net, or falling out at corners.'}</p>
                    </div>
                    
                    <svg viewBox="0 0 200 200" class="w-full border-2 rounded bg-white mb-3">
                        <!-- Hoppborg ovanifr√•n -->
                        <rect x="20" y="20" width="160" height="160" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                        
                        <!-- H√∂rn som m√•ste t√§ckas (r√∂da cirklar) -->
                        <circle cx="20" cy="20" r="18" fill="none" stroke="#f44336" stroke-width="4"/>
                        <circle cx="180" cy="20" r="18" fill="none" stroke="#f44336" stroke-width="4"/>
                        <circle cx="20" cy="180" r="18" fill="none" stroke="#f44336" stroke-width="4"/>
                        <circle cx="180" cy="180" r="18" fill="none" stroke="#f44336" stroke-width="4"/>
                        
                        <!-- N√§t som n√•r h√∂rnen (gr√∂na linjer) -->
                        <line x1="20" y1="20" x2="60" y2="60" stroke="#4caf50" stroke-width="4"/>
                        <line x1="180" y1="20" x2="140" y2="60" stroke="#4caf50" stroke-width="4"/>
                        <line x1="20" y1="180" x2="60" y2="140" stroke="#4caf50" stroke-width="4"/>
                        <line x1="180" y1="180" x2="140" y2="140" stroke="#4caf50" stroke-width="4"/>
                        
                        <!-- N√§t p√• sidor -->
                        <line x1="20" y1="60" x2="20" y2="140" stroke="#4caf50" stroke-width="3" opacity="0.5"/>
                        <line x1="180" y1="60" x2="180" y2="140" stroke="#4caf50" stroke-width="3" opacity="0.5"/>
                        <line x1="60" y1="20" x2="140" y2="20" stroke="#4caf50" stroke-width="3" opacity="0.5"/>
                        <line x1="60" y1="180" x2="140" y2="180" stroke="#4caf50" stroke-width="3" opacity="0.5"/>
                        
                        <text x="100" y="85" text-anchor="middle" font-weight="bold" font-size="10" fill="#4caf50">${app.lang === 'sv' ? 'N√ÑT M√ÖSTE VARA SYDDA' : 'NETS MUST BE SEWN'}</text>
                        <text x="100" y="100" text-anchor="middle" font-weight="bold" font-size="10" fill="#4caf50">${app.lang === 'sv' ? 'L√ÑNGST UT I' : 'ALL THE WAY TO'}</text>
                        <text x="100" y="115" text-anchor="middle" font-weight="bold" font-size="10" fill="#4caf50">${app.lang === 'sv' ? 'ALLA H√ñRN' : 'ALL CORNERS'}</text>
                    </svg>
                    
                    <div class="space-y-2 text-sm">
                        <div class="bg-red-50 p-2 rounded border-l-4 border-red-500">
                            <p class="font-semibold text-red-700">‚ùå ${app.lang === 'sv' ? 'UNDERK√ÑNT' : 'FAILED'}:</p>
                            <p>${app.lang === 'sv' ? 'N√§tet monteras bara p√• sidorna ‚Üí h√∂rnen √§r √∂ppna' : 'Net only mounted on sides ‚Üí corners are open'}</p>
                        </div>
                        
                        <div class="bg-green-50 p-2 rounded border-l-4 border-green-500">
                            <p class="font-semibold text-green-700">‚úì ${app.lang === 'sv' ? 'GODK√ÑNT' : 'APPROVED'}:</p>
                            <p>${app.lang === 'sv' ? 'N√§tet g√•r hela v√§gen till varje h√∂rn (r√∂da cirklar ovan)' : 'Net goes all the way to each corner (red circles above)'}</p>
                        </div>
                    </div>
                    
                    <p class="text-xs text-gray-600 mt-3 italic">Ref: EN 14960-1:2019, 4.2.9</p>
                `
            };
            
            m.innerHTML = modals[type] || '';
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        // Kamera
        async function startCamera() {
            try {
                app.stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                app.cameraActive = true;
                render();
                setTimeout(() => {
                    const v = document.getElementById('cam');
                    if (v) v.srcObject = app.stream;
                }, 100);
            } catch (e) {
                alert('Kamera: ' + e.message);
            }
        }

        function stopCamera() {
            if (app.stream) {
                app.stream.getTracks().forEach(t => t.stop());
                app.stream = null;
            }
            app.cameraActive = false;
            render();
        }

        // Bilder
        function addImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                app.data.images.push({
                    data: e.target.result,
                    name: file.name,
                    date: new Date().toISOString()
                });
                localStorage.setItem('hoppborg', JSON.stringify(app));
                render();
            };
            reader.readAsDataURL(file);
        }

        function removeImage(index) {
            app.data.images.splice(index, 1);
            localStorage.setItem('hoppborg', JSON.stringify(app));
            render();
        }

        // PDF Export
        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            let y = 20;

            pdf.setFontSize(20);
            pdf.setTextColor(37, 99, 235);
            pdf.text('Hoppborg Validator', 105, y, { align: 'center' });
            y += 10;
            
            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text('EN 14960-1:2019', 105, y, { align: 'center' });
            y += 15;

            pdf.setFontSize(14);
            pdf.setTextColor(0);
            pdf.text('Grunduppgifter', 20, y);
            y += 8;
            
            pdf.setFontSize(10);
            pdf.text(`L√§ngd: ${app.data.length} m | Bredd: ${app.data.width} m | H√∂jd: ${app.data.height} m`, 20, y);
            y += 6;
            pdf.text(`Produkt-ID: ${app.data.productId || 'Saknas'}`, 20, y);
            y += 10;

            if (app.result) {
                pdf.setFontSize(16);
                const statusColor = app.result.ok ? [34, 197, 94] : [220, 38, 38];
                pdf.setTextColor(...statusColor);
                pdf.text(app.result.ok ? '‚úì GODK√ÑND' : '‚úó UNDERK√ÑND', 20, y);
                y += 10;

                if (app.result.issues.length > 0) {
                    pdf.setFontSize(12);
                    pdf.setTextColor(0);
                    pdf.text('Avvikelser:', 20, y);
                    y += 8;
                    pdf.setFontSize(10);
                    
                    app.result.issues.forEach(issue => {
                        if (y > 270) {
                            pdf.addPage();
                            y = 20;
                        }
                        const color = issue.severity === 'critical' ? [220, 38, 38] : 
                                     issue.severity === 'serious' ? [249, 115, 22] : [234, 179, 8];
                        pdf.setTextColor(...color);
                        pdf.text(`‚Ä¢ ${issue.cat}: ${issue.msg}`, 25, y);
                        y += 5;
                        pdf.setTextColor(100);
                        pdf.setFontSize(8);
                        pdf.text(`  Ref: ${issue.ref}`, 25, y);
                        y += 4;
                        pdf.text(`  √Ötg√§rd: ${issue.action}`, 25, y);
                        y += 7;
                        pdf.setFontSize(10);
                    });
                }
            }

            const timestamp = new Date().toLocaleString('sv-SE');
            pdf.setFontSize(8);
            pdf.setTextColor(150);
            pdf.text(`Genererad: ${timestamp}`, 105, 287, { align: 'center' });

            pdf.save(`hoppborg-inspektion-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function render() {
            const c = calc();
            const d = app.data;
            
            document.getElementById('app').innerHTML = `
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-sm opacity-90">EN 14960-1:2019</div>
                            <h1 class="text-3xl font-bold">${app.lang === 'sv' ? 'Hoppborg Validator' : 'Bouncy Castle Validator'}</h1>
                            <p class="text-sm mt-1 opacity-90">${app.lang === 'sv' ? 'Baserad p√• Konsumentverkets marknadskontroll' : 'Based on Swedish Consumer Agency market surveillance'}</p>
                        </div>
                        <button onclick="toggleLang()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
                            üåç ${app.lang === 'sv' ? 'English' : 'Svenska'}
                        </button>
                    </div>
                </div>

                <!-- Grunduppgifter -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">üìè ${app.lang === 'sv' ? 'Grunduppgifter' : 'Basic Information'}</h2>
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                ${app.lang === 'sv' ? 'L√§ngd (m) *' : 'Length (m) *'}
                                <button onclick="showInfo('length')" class="inline-block w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600">?</button>
                            </label>
                            <input type="number" step="0.1" id="length" value="${d.length}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">${app.lang === 'sv' ? 'Kant till kant i l√§ngdriktning' : 'Edge to edge lengthwise'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                ${app.lang === 'sv' ? 'Bredd (m) *' : 'Width (m) *'}
                                <button onclick="showInfo('width')" class="inline-block w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600">?</button>
                            </label>
                            <input type="number" step="0.1" id="width" value="${d.width}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">${app.lang === 'sv' ? 'Kant till kant i tv√§rriktning' : 'Edge to edge crosswise'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                ${app.lang === 'sv' ? 'H√∂jd (m) *' : 'Height (m) *'}
                                <button onclick="showInfo('height')" class="inline-block w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600">?</button>
                            </label>
                            <input type="number" step="0.1" id="height" value="${d.height}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">${app.lang === 'sv' ? 'Mark ‚Üí v√§gg (EJ dekorationer!)' : 'Ground ‚Üí wall (NO decorations!)'}</p>
                        </div>
                    </div>
                    
                    <!-- Individuella h√∂jder per sida -->
                    <div class="border-t pt-4 mt-4">
                        <label class="flex items-center gap-2 mb-3">
                            <input type="checkbox" id="useIndividualHeights" ${d.useIndividualHeights?'checked':''} class="w-4 h-4">
                            <span class="text-sm font-semibold">
                                üéØ Olika h√∂jder per sida (f√∂r exakt Annex A-ber√§kning)
                            </span>
                        </label>
                        <p class="text-xs text-gray-600 mb-3">
                            Aktivera detta om sidorna har olika h√∂jder (t.ex. √∂ppen ing√•ng fram, h√∂gre baksida). 
                            Annars anv√§nds den generella h√∂jden ovan f√∂r alla sidor.
                        </p>
                        
                        ${d.useIndividualHeights ? `
                        <div class="grid grid-cols-4 gap-3 bg-blue-50 p-3 rounded">
                            <div>
                                <label class="block text-xs font-medium mb-1">H√∂jd Sida A (Fram)</label>
                                <input type="number" step="0.1" id="heightA" value="${d.heightA}" class="w-full p-2 border rounded text-sm" placeholder="${d.height}">
                            </div>
                            <div>
                                <label class="block text-xs font-medium mb-1">H√∂jd Sida B (H√∂ger)</label>
                                <input type="number" step="0.1" id="heightB" value="${d.heightB}" class="w-full p-2 border rounded text-sm" placeholder="${d.height}">
                            </div>
                            <div>
                                <label class="block text-xs font-medium mb-1">H√∂jd Sida C (Bak)</label>
                                <input type="number" step="0.1" id="heightC" value="${d.heightC}" class="w-full p-2 border rounded text-sm" placeholder="${d.height}">
                            </div>
                            <div>
                                <label class="block text-xs font-medium mb-1">H√∂jd Sida D (V√§nster)</label>
                                <input type="number" step="0.1" id="heightD" value="${d.heightD}" class="w-full p-2 border rounded text-sm" placeholder="${d.height}">
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>

                <!-- Typ & konstruktion -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">üè∞ Typ och konstruktion</h2>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Typ *</label>
                            <select id="type" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj typ --</option>
                                <option value="flatbed" ${d.type==='flatbed'?'selected':''}>Flat-bed (4 √∂ppna sidor)</option>
                                <option value="castle" ${d.type==='castle'?'selected':''}>Castle (3 v√§ggar, 1 √∂ppen)</option>
                                <option value="aframe" ${d.type==='aframe'?'selected':''}>A-Frame inflatable</option>
                                <option value="combo" ${d.type==='combo'?'selected':''}>Bounce/Slide kombination</option>
                                <option value="multiplay" ${d.type==='multiplay'?'selected':''}>Multi-Play Center</option>
                                <option value="obstacle" ${d.type==='obstacle'?'selected':''}>Hinderbana</option>
                                <option value="slide" ${d.type==='slide'?'selected':''}>Inflatable slide</option>
                                <option value="enclosed" ${d.type==='enclosed'?'selected':''}>Enclosed inflatable</option>
                                <option value="softmountain" ${d.type==='softmountain'?'selected':''}>Soft mountain</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">Plattformsh√∂jd (m)</label>
                            <input type="number" step="0.1" id="platformHeight" value="${d.platformHeight}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">Fr√•n mark till lekyta (4.2.3)</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">V√§ggh√∂jd (m)</label>
                            <input type="number" step="0.1" id="wallHeight" value="${d.wallHeight}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">Fr√•n lekyta till v√§ggtop (4.2.9)</p>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">Har rutschbana?</label>
                            <select id="hasSlide" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="yes" ${d.hasSlide==='yes'?'selected':''}>Ja</option>
                                <option value="no" ${d.hasSlide==='no'?'selected':''}>Nej</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">Finns rep?</label>
                            <select id="hasRopes" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="no" ${d.hasRopes==='no'?'selected':''}>Nej</option>
                                <option value="yes" ${d.hasRopes==='yes'?'selected':''}>Ja</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-1">Har n√§t?</label>
                            <select id="hasNetting" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="yes" ${d.hasNetting==='yes'?'selected':''}>Ja</option>
                                <option value="no" ${d.hasNetting==='no'?'selected':''}>Nej</option>
                            </select>
                        </div>
                        
                        ${d.hasNetting === 'yes' ? `
                        <div>
                            <label class="block text-sm font-medium mb-1">Maskstorlek (mm)</label>
                            <input type="number" id="nettingMesh" value="${d.nettingMesh}" class="w-full p-2 border rounded" placeholder="Max 8">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                N√•r h√∂rnen?
                                <button onclick="showInfo('corners')" class="inline-block w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600">?</button>
                            </label>
                            <select id="nettingCorners" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="yes" ${d.nettingCorners==='yes'?'selected':''}>Ja</option>
                                <option value="no" ${d.nettingCorners==='no'?'selected':''}>Nej</option>
                            </select>
                        </div>
                        ` : ''}
                    </div>
                </div>

                <!-- Slide -->
                ${d.hasSlide === 'yes' ? `
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6 border-l-4 border-purple-500">
                    <h2 class="text-xl font-bold mb-4">
                        üõù Rutschbana-specifika krav
                        <button onclick="showInfo('runout')" class="inline-block w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600">?</button>
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Slide plattformsh√∂jd (m)</label>
                            <input type="number" step="0.1" id="slideHeight" value="${d.slideHeight}" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Run-out l√§ngd (m)</label>
                            <input type="number" step="0.1" id="runoutLength" value="${d.runoutLength}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">Min 50% av h√∂jd ELLER 0.3m</p>
                        </div>
                        <div class="col-span-2">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="hasStopWall" ${d.hasStopWall?'checked':''} class="w-4 h-4">
                                <span class="text-sm font-medium">Har stoppv√§gg (+500mm till√§gg)</span>
                            </label>
                        </div>
                    </div>
                    ${c ? `
                    <div class="mt-4 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
                        <p class="text-sm font-semibold">üßÆ Ber√§knad run-out:</p>
                        <p class="text-sm">Krav: <strong>${c.runoutRequired.toFixed(2)} m</strong></p>
                    </div>
                    ` : ''}
                </div>
                ` : ''}

                <!-- Trappa/Ing√•ng -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">
                        üö™ Ing√•ng/Trappa (4.2.3)
                        <button onclick="showInfo('treadDepth')" class="inline-block w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600">?</button>
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Ing√•ngsh√∂jd (m)</label>
                            <input type="number" step="0.1" id="entranceHeight" value="${d.entranceHeight}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">Max 0.63m (loaded), 0.6m (unloaded)</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Trappdjup (m)</label>
                            <input type="number" step="0.1" id="entranceTreadDepth" value="${d.entranceTreadDepth}" class="w-full p-2 border rounded">
                            <p class="text-xs text-gray-500 mt-1">Min 1.5√ó plattformsh√∂jd</p>
                        </div>
                    </div>
                    ${c && c.minTreadDepth > 0 ? `
                    <div class="mt-3 p-2 bg-blue-50 rounded text-sm">
                        <p class="font-semibold">Ber√§knat fr√•n plattformsh√∂jd (${app.data.platformHeight}m):</p>
                        <p>Minsta trappdjup: <strong>${c.minTreadDepth.toFixed(2)} m</strong></p>
                    </div>
                    ` : ''}
                </div>

                <!-- F√∂rankring -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        ‚öì F√∂rankring
                        <button onclick="showInfo('annexA')" class="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200">
                            üìê Annex A F√∂rklaring
                        </button>
                    </h2>

                    ${c && c.L && c.W ? `
                    <div class="mb-4 p-4 bg-blue-50 rounded">
                        <div class="text-center font-semibold mb-2">√ñversikt f√§stpunkter</div>
                        <svg viewBox="0 0 ${c.L * 40} ${c.W * 40}" class="w-full max-w-md mx-auto border-2 border-blue-500 bg-white rounded">
                            <rect x="0" y="0" width="${c.L * 40}" height="${c.W * 40}" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
                            <text x="${c.L * 20}" y="20" text-anchor="middle" font-weight="bold" fill="#1e40af">Sida A</text>
                            <text x="${c.L * 40 - 10}" y="${c.W * 20}" text-anchor="end" font-weight="bold" fill="#1e40af" transform="rotate(-90 ${c.L * 40 - 10} ${c.W * 20})">B</text>
                            <text x="${c.L * 20}" y="${c.W * 40 - 5}" text-anchor="middle" font-weight="bold" fill="#1e40af">Sida C</text>
                            <text x="10" y="${c.W * 20}" font-weight="bold" fill="#1e40af" transform="rotate(-90 10 ${c.W * 20})">D</text>
                        </svg>
                    </div>
                    ` : ''}

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        ${c ? ['A', 'B', 'C', 'D'].map(s => `
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                Sida ${s}: F√§stpunkter
                                <span class="text-xs text-gray-500">(Krav: ${c.anchors[s].need} st @ ${c.anchors[s].height.toFixed(1)}m h√∂jd)</span>
                            </label>
                            <input type="number" id="anchor${s}" value="${d['anchor'+s]}" class="w-full p-2 border rounded">
                            ${d.useIndividualHeights ? `<p class="text-xs text-blue-600 mt-1">H√∂jd: ${c.anchors[s].height.toFixed(1)}m √ó ${c.anchors[s].len}m = ${(c.anchors[s].len * c.anchors[s].height).toFixed(1)}m¬≤ yta</p>` : ''}
                        </div>
                        `).join('') : ''}
                        <div>
                            <label class="block text-sm font-medium mb-1">F√∂rankringsvinkel (¬∞)</label>
                            <input type="number" id="anchorAngle" value="${d.anchorAngle}" class="w-full p-2 border rounded" placeholder="30-45">
                        </div>
                    </div>

                    <button onclick="app.cameraActive ? stopCamera() : startCamera()" 
                        class="w-full flex items-center justify-center gap-2 py-3 rounded-lg font-medium mb-4 ${
                            app.cameraActive ? 'bg-red-600 text-white' : 'bg-green-600 text-white'
                        }">
                        üì∑ ${app.cameraActive ? 'St√§ng kamera' : '√ñppna kamera f√∂r vinkelm√§tning'}
                    </button>

                    ${app.cameraActive ? `
                    <div class="mb-6 relative bg-black rounded-lg overflow-hidden">
                        <video id="cam" autoplay playsinline class="w-full"></video>
                        <svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <line x1="0" y1="80" x2="100" y2="80" stroke="#22c55e" stroke-width="0.5" stroke-dasharray="2,2"/>
                            <line x1="50" y1="80" x2="85" y2="60" stroke="#fbbf24" stroke-width="0.8"/>
                            <text x="70" y="58" fill="#fbbf24" font-size="4" font-weight="bold">30¬∞</text>
                            <line x1="50" y1="80" x2="80" y2="50" stroke="#ef4444" stroke-width="0.8"/>
                            <text x="65" y="48" fill="#ef4444" font-size="4" font-weight="bold">45¬∞</text>
                            <path d="M 50 80 L 85 60 L 80 50 Z" fill="#22c55e" opacity="0.2"/>
                            <circle cx="50" cy="80" r="2" fill="#22c55e"/>
                        </svg>
                    </div>
                    ` : ''}
                </div>

                <!-- Lufttryck -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">üí® Lufttryck & Fl√§ktar</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Antal fl√§ktar</label>
                            <input type="number" id="blowersNeeded" value="${d.blowersNeeded}" class="w-full p-2 border rounded">
                            ${c ? `<p class="text-xs text-gray-500 mt-1">Ber√§knat: ${c.blowersNeeded} st</p>` : ''}
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Fl√§kteffekt (W)</label>
                            <input type="number" id="blowerPower" value="${d.blowerPower}" class="w-full p-2 border rounded" placeholder="1500">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-sm font-medium mb-1">
                                Inbl√•sr√∂rets l√§ngd (m) *
                                <button onclick="showInfo('blowerTube')" class="inline-block w-5 h-5 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600">?</button>
                            </label>
                            <input type="number" step="0.1" id="blowerTubeLength" value="${d.blowerTubeLength}" class="w-full p-2 border rounded">
                            <div class="mt-2 space-y-1">
                                <p class="text-xs text-red-600 font-semibold">‚ö†Ô∏è Minimum 1.2m fr√•n v√§gg, 2.5m fr√•n √∂ppen sida</p>
                                <p class="text-xs text-green-600 font-semibold">‚úì Rekommenderat: 1.4m eller l√§ngre</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- M√§rkning -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">üè∑Ô∏è M√§rkning & Tillverkarkrav</h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Produkt-ID *</label>
                            <input type="text" id="productId" value="${d.productId}" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">ID synligt?</label>
                            <select id="idVisible" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="yes" ${d.idVisible==='yes'?'selected':''}>Ja</option>
                                <option value="no" ${d.idVisible==='no'?'selected':''}>Nej</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Tillverkarens max anv√§ndare</label>
                            <input type="number" id="manufacturerMaxUsers" value="${d.manufacturerMaxUsers}" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Tillverkarens max anv√§ndarl√§ngd (m)</label>
                            <input type="number" step="0.1" id="manufacturerUserHeight" value="${d.manufacturerUserHeight}" class="w-full p-2 border rounded">
                        </div>
                        <div class="col-span-2">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="hasSafetyInstructions" ${d.hasSafetyInstructions?'checked':''} class="w-4 h-4">
                                <span class="text-sm font-medium">Finns s√§kerhetsinstruktion angiven</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Bilder -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">üì∏ Bilder fr√•n inspektion</h2>
                    <label class="block w-full cursor-pointer bg-orange-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-orange-700 text-center mb-4">
                        üì∏ L√§gg till bild
                        <input type="file" id="imageInput" accept="image/*" capture="environment" class="hidden">
                    </label>
                    
                    ${d.images.length > 0 ? `
                    <div class="grid grid-cols-2 gap-4">
                        ${d.images.map((img, i) => `
                            <div class="relative border rounded-lg overflow-hidden">
                                <img src="${img.data}" class="w-full h-32 object-cover">
                                <button onclick="removeImage(${i})" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-lg">√ó</button>
                                <div class="p-2 bg-gray-50 text-xs truncate">${img.name}</div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                </div>

                <button onclick="validate()" class="w-full bg-blue-600 text-white py-4 rounded-lg text-lg font-bold hover:bg-blue-700 mb-6">
                    ‚úì VALIDERA HOPPBORG
                </button>

                <!-- Resultat -->
                ${app.result ? `
                <div class="space-y-6">
                    <div class="rounded-lg shadow-lg p-6 border-l-8 ${
                        app.result.ok ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'
                    }">
                        <h3 class="text-2xl font-bold">${app.result.ok ? '‚úì GODK√ÑND' : '‚úó UNDERK√ÑND'}</h3>
                        <p>${app.result.issues.length} avvikelser totalt</p>
                    </div>

                    <!-- Sammanfattning -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold mb-4">üìä Sammanfattning</h3>
                        <div class="grid grid-cols-4 gap-4 mb-6">
                            <div class="bg-gray-50 p-4 rounded text-center">
                                <div class="text-3xl font-bold text-gray-600">${app.result.issues.length}</div>
                                <div class="text-sm">Totalt</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded text-center">
                                <div class="text-3xl font-bold text-red-600">${app.result.critical.length}</div>
                                <div class="text-sm">Kritiska</div>
                            </div>
                            <div class="bg-orange-50 p-4 rounded text-center">
                                <div class="text-3xl font-bold text-orange-600">${app.result.serious.length}</div>
                                <div class="text-sm">Allvarliga</div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded text-center">
                                <div class="text-3xl font-bold text-yellow-600">${app.result.warnings.length}</div>
                                <div class="text-sm">Varningar</div>
                            </div>
                        </div>

                        <!-- Krav vs Uppm√§tt -->
                        <h4 class="font-bold mb-3">Krav vs Uppm√§tta v√§rden</h4>
                        <div class="overflow-x-auto mb-6">
                            <table class="w-full text-sm border-collapse">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="p-2 text-left border">Parameter</th>
                                        <th class="p-2 text-left border">Krav</th>
                                        <th class="p-2 text-left border">Uppm√§tt</th>
                                        <th class="p-2 text-center border">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${['A', 'B', 'C', 'D'].map(s => {
                                        const req = c.anchors[s].need;
                                        const supplied = parseInt(d['anchor'+s]) || 0;
                                        const ok = supplied >= req;
                                        return `
                                        <tr class="${ok ? '' : 'bg-red-50'}">
                                            <td class="p-2 border">F√§stpunkter Sida ${s}</td>
                                            <td class="p-2 border">${req} st</td>
                                            <td class="p-2 border">${supplied} st</td>
                                            <td class="p-2 text-center border">
                                                <span class="${ok ? 'text-green-600' : 'text-red-600'}">${ok ? '‚úì' : '‚úó'}</span>
                                            </td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>

                        <!-- Kritiska fel -->
                        ${app.result.critical.length > 0 ? `
                        <h4 class="font-bold text-red-900 mb-3">Kritiska fel</h4>
                        <div class="space-y-3 mb-6">
                            ${app.result.critical.map(i => `
                                <div class="border-l-4 border-red-500 bg-red-50 p-4 rounded">
                                    <div class="font-semibold">${i.cat}</div>
                                    <div class="text-sm">${i.msg}</div>
                                    <div class="text-xs text-gray-600 mt-1">Ref: ${i.ref}</div>
                                    <div class="text-xs text-red-800 mt-2"><strong>√Ötg√§rd:</strong> ${i.action}</div>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}

                        <!-- Allvarliga fel -->
                        ${app.result.serious.length > 0 ? `
                        <h4 class="font-bold text-orange-900 mb-3">Allvarliga fel</h4>
                        <div class="space-y-3 mb-6">
                            ${app.result.serious.map(i => `
                                <div class="border-l-4 border-orange-500 bg-orange-50 p-4 rounded">
                                    <div class="font-semibold">${i.cat}</div>
                                    <div class="text-sm">${i.msg}</div>
                                    <div class="text-xs text-gray-600 mt-1">Ref: ${i.ref}</div>
                                    <div class="text-xs text-orange-800 mt-2"><strong>√Ötg√§rd:</strong> ${i.action}</div>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}

                        <!-- Varningar -->
                        ${app.result.warnings.length > 0 ? `
                        <h4 class="font-bold text-yellow-900 mb-3">Varningar</h4>
                        <div class="space-y-3 mb-6">
                            ${app.result.warnings.map(i => `
                                <div class="border-l-4 border-yellow-500 bg-yellow-50 p-4 rounded">
                                    <div class="font-semibold">${i.cat}</div>
                                    <div class="text-sm">${i.msg}</div>
                                    <div class="text-xs text-gray-600 mt-1">Ref: ${i.ref}</div>
                                    <div class="text-xs text-yellow-800 mt-2"><strong>√Ötg√§rd:</strong> ${i.action}</div>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>

                    <div class="flex gap-3">
                        <button onclick="exportPDF()" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700">
                            üìÑ Spara som PDF
                        </button>
                        <button onclick="app.result=null; render()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-medium hover:bg-gray-700">
                            üîÑ Ny validering
                        </button>
                    </div>
                </div>
                ` : ''}
            `;

            // Event listeners
            ['length','width','height','heightA','heightB','heightC','heightD','type','platformHeight','wallHeight','hasSlide','slideHeight',
             'runoutLength','entranceHeight','entranceTreadDepth','anchorA','anchorB','anchorC','anchorD',
             'anchorAngle','blowersNeeded','blowerPower','blowerTubeLength','productId','idVisible',
             'manufacturerMaxUsers','manufacturerUserHeight','hasRopes','hasNetting','nettingMesh','nettingCorners'].forEach(f => {
                const el = document.getElementById(f);
                if (el) el.addEventListener('change', e => { app.data[f] = e.target.value; render(); });
            });

            ['hasSafetyInstructions', 'hasStopWall', 'useIndividualHeights'].forEach(f => {
                const el = document.getElementById(f);
                if (el) el.addEventListener('change', e => { app.data[f] = e.target.checked; render(); });
            });

            const imgInput = document.getElementById('imageInput');
            if (imgInput) {
                imgInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) addImage(file);
                });
            }
        }

        // Initial render
        const saved = localStorage.getItem('hoppborg');
        if (saved) {
            const parsed = JSON.parse(saved);
            app.data = parsed.data || app.data;
        }
        render();
    </script>
</body>
</html>
