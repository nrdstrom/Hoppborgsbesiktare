<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoppborg Validator - EN 14960-1:2019</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-50">
    <div id="app" class="max-w-4xl mx-auto p-4"></div>
    
    <div id="modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50" onclick="closeModal()">
        <div class="bg-white rounded-lg p-6 max-w-md mx-4" onclick="event.stopPropagation()">
            <button onclick="closeModal()" class="float-right text-2xl">&times;</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        const app = {
            data: {
                length: '', width: '', height: '', type: '', productId: '', idVisible: '',
                hasSafetyInstructions: false, hasRopes: '', anchorA: '', anchorB: '', anchorC: '', anchorD: '',
                anchorAngle: '', hasNetting: '', nettingMesh: '', nettingCorners: '',
                blowersNeeded: '', blowerPower: '', maxUsers: '', images: []
            },
            result: null, cameraActive: false, stream: null
        };

        function showInfo(type) {
            const m = document.getElementById('modalContent');
            if (type === 'corners') {
                m.innerHTML = `
                    <h3 class="font-bold mb-4">N√§t i h√∂rnen</h3>
                    <svg viewBox="0 0 200 200" class="w-full border-2 rounded">
                        <rect x="20" y="20" width="160" height="160" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
                        <circle cx="20" cy="20" r="15" fill="none" stroke="#f44336" stroke-width="3"/>
                        <circle cx="180" cy="20" r="15" fill="none" stroke="#f44336" stroke-width="3"/>
                        <circle cx="20" cy="180" r="15" fill="none" stroke="#f44336" stroke-width="3"/>
                        <circle cx="180" cy="180" r="15" fill="none" stroke="#f44336" stroke-width="3"/>
                        <line x1="20" y1="20" x2="60" y2="60" stroke="#4caf50" stroke-width="3"/>
                        <line x1="180" y1="20" x2="140" y2="60" stroke="#4caf50" stroke-width="3"/>
                        <text x="100" y="110" text-anchor="middle" font-weight="bold">N√ÑT M√ÖSTE N√Ö H√ñRNEN</text>
                    </svg>
                    <p class="mt-4 text-sm">R√∂da cirklar = h√∂rn som m√•ste t√§ckas helt</p>
                `;
            }
            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function calc() {
            const L = parseFloat(app.data.length) || 0;
            const W = parseFloat(app.data.width) || 0;
            const H = parseFloat(app.data.height) || 0;
            if (!L || !W || !H) return null;

            const calcSide = (area) => {
                const F = 0.5 * 1.5 * 1.24 * 11.1 * 11.1 * area;
                const n = F / 1600;
                let need = Math.ceil(n);
                if (n % 1 > 0.6) need += 1;
                return Math.max(need, 2);
            };

            const anchors = {
                A: { name: 'Sida A', len: L, need: calcSide(L * H) },
                B: { name: 'Sida B (H√∂ger)', len: W, need: calcSide(W * H) },
                C: { name: 'Sida C (Back)', len: L, need: calcSide(L * H) },
                D: { name: 'Sida D (V√§nster)', len: W, need: calcSide(W * H) }
            };

            const total = Object.values(anchors).reduce((s, a) => s + a.need, 0);
            const minAnchors = Math.max(6, total);
            const area = Math.max(0, (L - 0.6) * (W - 0.6));
            const maxU = Math.floor(area / 2);

            // Lufttryck: 1 kPa, volym ‚âà L√óW√óH, fl√§kt ~1500W per 100m¬≥
            const volume = L * W * H;
            const blowersNeeded = Math.ceil(volume / 100);

            return { anchors, minAnchors, area: area.toFixed(2), maxU, L, W, blowersNeeded };
        }

        function validate() {
            const c = calc();
            if (!c) return;

            const issues = [];
            const passes = [];

            if (!app.data.productId) issues.push({ cat: 'M√§rkning', msg: 'Produkt-ID saknas', ref: '8' });
            if (app.data.idVisible === 'no') issues.push({ cat: 'M√§rkning', msg: 'ID ej synligt', ref: '8' });
            if (!app.data.hasSafetyInstructions) issues.push({ cat: 'M√§rkning', msg: 'S√§kerhetsinstruktion saknas', ref: '6' });
            if (app.data.hasRopes === 'yes') issues.push({ cat: 'S√§kerhet', msg: 'REP F√ñRBJUDET!', ref: '4.1.4' });

            ['A', 'B', 'C', 'D'].forEach(side => {
                const supplied = parseInt(app.data['anchor' + side]) || 0;
                const req = c.anchors[side].need;
                if (supplied > 0 && supplied < req) {
                    issues.push({ cat: `F√§stpunkt ${side}`, msg: `${supplied} st < ${req} st`, ref: 'Annex A' });
                }
            });

            const angle = parseInt(app.data.anchorAngle) || 0;
            if (angle > 0 && (angle < 30 || angle > 45)) {
                issues.push({ cat: 'Vinkel', msg: `${angle}¬∞ (ska vara 30-45¬∞)`, ref: '4.2.1' });
            }

            if (app.data.hasNetting === 'yes') {
                const mesh = parseFloat(app.data.nettingMesh) || 0;
                if (mesh > 8) issues.push({ cat: 'N√§t', msg: `${mesh}mm > 8mm`, ref: '4.1.3' });
                if (app.data.nettingCorners === 'no') issues.push({ cat: 'N√§t', msg: 'N√•r ej h√∂rn', ref: '4.2.9' });
            }

            const blowers = parseInt(app.data.blowersNeeded) || 0;
            if (blowers > 0 && blowers < c.blowersNeeded) {
                issues.push({ cat: 'Lufttryck', msg: `${blowers} fl√§ktar < ${c.blowersNeeded} kr√§vs`, ref: '4.2.2' });
            }

            app.result = { calc: c, issues, passes, ok: issues.length === 0 };
            localStorage.setItem('hoppborg', JSON.stringify(app));
            render();
        }

        async function startCamera() {
            try {
                app.stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                app.cameraActive = true;
                render();
                setTimeout(() => {
                    const v = document.getElementById('cam');
                    if (v) v.srcObject = app.stream;
                }, 100);
            } catch (e) {
                alert('Kamera: ' + e.message);
            }
        }

        function stopCamera() {
            if (app.stream) {
                app.stream.getTracks().forEach(t => t.stop());
                app.stream = null;
            }
            app.cameraActive = false;
            render();
        }

        function addImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                app.data.images.push({
                    data: e.target.result,
                    name: file.name,
                    date: new Date().toISOString()
                });
                localStorage.setItem('hoppborg', JSON.stringify(app));
                render();
            };
            reader.readAsDataURL(file);
        }

        function removeImage(index) {
            app.data.images.splice(index, 1);
            localStorage.setItem('hoppborg', JSON.stringify(app));
            render();
        }

        async function exportPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            let y = 20;

            // Titel
            pdf.setFontSize(20);
            pdf.setTextColor(37, 99, 235);
            pdf.text('Hoppborg Validator', pageWidth / 2, y, { align: 'center' });
            y += 10;
            pdf.setFontSize(10);
            pdf.setTextColor(100);
            pdf.text('EN 14960-1:2019', pageWidth / 2, y, { align: 'center' });
            y += 15;

            // Grunduppgifter
            pdf.setFontSize(14);
            pdf.setTextColor(0);
            pdf.text('Grunduppgifter', 20, y);
            y += 8;
            pdf.setFontSize(10);
            pdf.text(`L√§ngd: ${app.data.length} m | Bredd: ${app.data.width} m | H√∂jd: ${app.data.height} m`, 20, y);
            y += 6;
            pdf.text(`Typ: ${app.data.type || 'Ej angiven'}`, 20, y);
            y += 6;
            pdf.text(`Produkt-ID: ${app.data.productId || 'Saknas'}`, 20, y);
            y += 10;

            // Resultat
            if (app.result) {
                pdf.setFontSize(16);
                pdf.setTextColor(app.result.ok ? 34 : 220, app.result.ok ? 197 : 38, app.result.ok ? 94 : 38);
                pdf.text(app.result.ok ? '‚úì GODK√ÑND' : '‚úó UNDERK√ÑND', 20, y);
                y += 10;

                if (app.result.issues.length > 0) {
                    pdf.setFontSize(12);
                    pdf.setTextColor(0);
                    pdf.text('Kritiska fel:', 20, y);
                    y += 8;
                    pdf.setFontSize(10);
                    
                    app.result.issues.forEach(issue => {
                        if (y > pageHeight - 30) {
                            pdf.addPage();
                            y = 20;
                        }
                        pdf.setTextColor(220, 38, 38);
                        pdf.text(`‚Ä¢ ${issue.cat}: ${issue.msg}`, 25, y);
                        y += 5;
                        pdf.setTextColor(100);
                        pdf.setFontSize(8);
                        pdf.text(`  Referens: ${issue.ref}`, 25, y);
                        y += 7;
                        pdf.setFontSize(10);
                    });
                }
            }

            // Bilder
            if (app.data.images.length > 0) {
                y += 5;
                if (y > pageHeight - 80) {
                    pdf.addPage();
                    y = 20;
                }
                pdf.setFontSize(12);
                pdf.setTextColor(0);
                pdf.text('Bifogade bilder:', 20, y);
                y += 10;

                for (let i = 0; i < app.data.images.length; i++) {
                    const img = app.data.images[i];
                    try {
                        const imgWidth = 80;
                        const imgHeight = 60;
                        
                        if (y + imgHeight > pageHeight - 20) {
                            pdf.addPage();
                            y = 20;
                        }
                        
                        pdf.addImage(img.data, 'JPEG', 20, y, imgWidth, imgHeight);
                        y += imgHeight + 3;
                        pdf.setFontSize(8);
                        pdf.setTextColor(100);
                        pdf.text(img.name, 20, y);
                        y += 8;
                    } catch (e) {
                        console.error('Kunde inte l√§gga till bild:', e);
                    }
                }
            }

            // Footer
            const timestamp = new Date().toLocaleString('sv-SE');
            pdf.setFontSize(8);
            pdf.setTextColor(150);
            pdf.text(`Genererad: ${timestamp}`, pageWidth / 2, pageHeight - 10, { align: 'center' });

            pdf.save(`hoppborg-inspektion-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function render() {
            const c = calc();
            const d = app.data;
            
            document.getElementById('app').innerHTML = `
                <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="text-sm opacity-90">EN 14960-1:2019</div>
                    <h1 class="text-3xl font-bold">Hoppborg Validator</h1>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4">Grunduppgifter</h2>
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium mb-1">L√§ngd (m) *</label>
                            <input type="number" step="0.1" id="length" value="${d.length}" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Bredd (m) *</label>
                            <input type="number" step="0.1" id="width" value="${d.width}" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">H√∂jd (m) *</label>
                            <input type="number" step="0.1" id="height" value="${d.height}" class="w-full p-2 border rounded">
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-3">Typ och detaljer</h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Typ</label>
                            <select id="type" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="flatbed" ${d.type==='flatbed'?'selected':''}>Flat-bed (4 √∂ppna sidor)</option>
                                <option value="castle" ${d.type==='castle'?'selected':''}>Castle (3 v√§ggar, 1 √∂ppen)</option>
                                <option value="aframe" ${d.type==='aframe'?'selected':''}>A-Frame inflatable</option>
                                <option value="combo" ${d.type==='combo'?'selected':''}>Bounce/Slide kombination</option>
                                <option value="multiplay" ${d.type==='multiplay'?'selected':''}>Multi-Play Center</option>
                                <option value="obstacle" ${d.type==='obstacle'?'selected':''}>Hinderbana</option>
                                <option value="slide" ${d.type==='slide'?'selected':''}>Inflatable slide</option>
                                <option value="enclosed" ${d.type==='enclosed'?'selected':''}>Enclosed inflatable</option>
                                <option value="softmountain" ${d.type==='softmountain'?'selected':''}>Soft mountain</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Finns rep f√∂r att underl√§tta kl√§ttring?</label>
                            <select id="hasRopes" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="no" ${d.hasRopes==='no'?'selected':''}>Nej</option>
                                <option value="yes" ${d.hasRopes==='yes'?'selected':''}>Ja</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Har n√§t</label>
                            <select id="hasNetting" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="yes" ${d.hasNetting==='yes'?'selected':''}>Ja</option>
                                <option value="no" ${d.hasNetting==='no'?'selected':''}>Nej</option>
                            </select>
                        </div>
                        ${d.hasNetting === 'yes' ? `
                        <div>
                            <label class="block text-sm font-medium mb-1">Maskstorlek (mm)</label>
                            <input type="number" id="nettingMesh" value="${d.nettingMesh}" class="w-full p-2 border rounded" placeholder="Max 8">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                T√§cker n√§ten √§nda ut i h√∂rnen?
                                <button onclick="showInfo('corners')" class="ml-1 text-blue-600">‚ÑπÔ∏è</button>
                            </label>
                            <select id="nettingCorners" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="yes" ${d.nettingCorners==='yes'?'selected':''}>Ja</option>
                                <option value="no" ${d.nettingCorners==='no'?'selected':''}>Nej</option>
                            </select>
                        </div>
                        ` : ''}
                    </div>

                    <h3 class="text-lg font-semibold mb-3 pb-2 border-b-2 border-green-600">Lufttryck</h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                Hur m√•nga fl√§ktar kr√§vs f√∂r godk√§nt lufttryck (‚â•1 kPa)?
                            </label>
                            <input type="number" id="blowersNeeded" value="${d.blowersNeeded}" class="w-full p-2 border rounded" placeholder="${c ? c.blowersNeeded : '?'}">
                            ${c ? `<p class="text-xs text-gray-500 mt-1">Ber√§knat: ${c.blowersNeeded} st f√∂r denna volym</p>` : ''}
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Ange effekt p√• fl√§kten/fl√§ktarna (W)</label>
                            <input type="number" id="blowerPower" value="${d.blowerPower}" class="w-full p-2 border rounded" placeholder="1500">
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-3 pb-2 border-b-2 border-blue-600">F√∂rankring</h3>
                    
                    ${c && c.L && c.W ? `
                    <div class="mb-4 p-4 bg-blue-50 rounded">
                        <div class="text-center font-semibold mb-2">√ñversikt f√§stpunkter</div>
                        <svg viewBox="0 0 ${c.L * 40} ${c.W * 40}" class="w-full max-w-md mx-auto border-2 border-blue-500 bg-white rounded">
                            <rect x="0" y="0" width="${c.L * 40}" height="${c.W * 40}" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
                            <text x="${c.L * 20}" y="20" text-anchor="middle" font-weight="bold" fill="#1e40af">Sida A</text>
                            <text x="${c.L * 40 - 10}" y="${c.W * 20}" text-anchor="end" font-weight="bold" fill="#1e40af" transform="rotate(-90 ${c.L * 40 - 10} ${c.W * 20})">B</text>
                            <text x="${c.L * 20}" y="${c.W * 40 - 5}" text-anchor="middle" font-weight="bold" fill="#1e40af">Sida C</text>
                            <text x="10" y="${c.W * 20}" font-weight="bold" fill="#1e40af" transform="rotate(-90 10 ${c.W * 20})">D</text>
                        </svg>
                    </div>
                    ` : ''}

                    <div class="grid grid-cols-2 gap-4 mb-4">
                        ${c ? ['A', 'B', 'C', 'D'].map(s => `
                        <div>
                            <label class="block text-sm font-medium mb-1">
                                Sida ${s}: Antal f√§stpunkter
                                <span class="text-xs text-gray-500">(Krav: ${c.anchors[s].need} st)</span>
                            </label>
                            <input type="number" id="anchor${s}" value="${d['anchor'+s]}" class="w-full p-2 border rounded">
                        </div>
                        `).join('') : ''}
                        <div>
                            <label class="block text-sm font-medium mb-1">F√∂rankringsvinkel (¬∞)</label>
                            <input type="number" id="anchorAngle" value="${d.anchorAngle}" class="w-full p-2 border rounded" placeholder="30-45">
                        </div>
                    </div>

                    <button onclick="app.cameraActive ? stopCamera() : startCamera()" 
                        class="w-full flex items-center justify-center gap-2 py-3 rounded-lg font-medium mb-4 ${
                            app.cameraActive ? 'bg-red-600 text-white' : 'bg-green-600 text-white'
                        }">
                        üì∑ ${app.cameraActive ? 'St√§ng kamera' : '√ñppna kamera f√∂r vinkelm√§tning'}
                    </button>

                    ${app.cameraActive ? `
                    <div class="mb-6 relative bg-black rounded-lg overflow-hidden">
                        <video id="cam" autoplay playsinline class="w-full"></video>
                        <svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <line x1="0" y1="80" x2="100" y2="80" stroke="#22c55e" stroke-width="0.5" stroke-dasharray="2,2"/>
                            <line x1="50" y1="80" x2="85" y2="60" stroke="#fbbf24" stroke-width="0.8"/>
                            <text x="70" y="58" fill="#fbbf24" font-size="4" font-weight="bold">30¬∞</text>
                            <line x1="50" y1="80" x2="80" y2="50" stroke="#ef4444" stroke-width="0.8"/>
                            <text x="65" y="48" fill="#ef4444" font-size="4" font-weight="bold">45¬∞</text>
                            <path d="M 50 80 L 85 60 L 80 50 Z" fill="#22c55e" opacity="0.2"/>
                            <circle cx="50" cy="80" r="2" fill="#22c55e"/>
                        </svg>
                    </div>
                    ` : ''}

                    <h3 class="text-lg font-semibold mb-3 pb-2 border-b-2 border-purple-600">M√§rkning & Anv√§ndare</h3>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium mb-1">Produkt-ID *</label>
                            <input type="text" id="productId" value="${d.productId}" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">ID synligt</label>
                            <select id="idVisible" class="w-full p-2 border rounded">
                                <option value="">-- V√§lj --</option>
                                <option value="yes" ${d.idVisible==='yes'?'selected':''}>Ja</option>
                                <option value="no" ${d.idVisible==='no'?'selected':''}>Nej</option>
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="hasSafetyInstructions" ${d.hasSafetyInstructions?'checked':''} class="w-4 h-4">
                                <span class="text-sm font-medium">Finns s√§kerhetsinstruktion angiven</span>
                            </label>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-3 pb-2 border-b-2 border-orange-600">Bilder</h3>
                    <div class="mb-6">
                        <label class="block w-full cursor-pointer bg-orange-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-orange-700 text-center">
                            üì∏ L√§gg till bild
                            <input type="file" id="imageInput" accept="image/*" capture="environment" class="hidden">
                        </label>
                        
                        ${d.images.length > 0 ? `
                        <div class="mt-4 grid grid-cols-2 gap-4">
                            ${d.images.map((img, i) => `
                                <div class="relative border rounded-lg overflow-hidden">
                                    <img src="${img.data}" class="w-full h-32 object-cover">
                                    <button onclick="removeImage(${i})" class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center">√ó</button>
                                    <div class="p-2 bg-gray-50 text-xs truncate">${img.name}</div>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>

                    <button onclick="validate()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 mb-3">
                        Validera
                    </button>
                </div>

                ${app.result ? `
                <div class="space-y-6">
                    <div class="rounded-lg shadow-lg p-6 border-l-8 ${
                        app.result.ok ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'
                    }">
                        <h3 class="text-2xl font-bold">${app.result.ok ? '‚úì GODK√ÑND' : '‚úó UNDERK√ÑND'}</h3>
                        <p>${app.result.issues.length} kritiska fel</p>
                    </div>

                    ${app.result.issues.length > 0 ? `
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-xl font-bold text-red-900 mb-4">Kritiska fel</h3>
                        ${app.result.issues.map(i => `
                            <div class="border-l-4 border-red-500 bg-red-50 p-4 rounded mb-3">
                                <div class="font-semibold">${i.cat}</div>
                                <div class="text-sm">${i.msg}</div>
                                <div class="text-xs text-gray-600">EN 14960-1:2019, ${i.ref}</div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}

                    <div class="flex gap-3">
                        <button onclick="exportPDF()" class="flex-1 bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700">
                            üìÑ Spara som PDF
                        </button>
                        <button onclick="app.result=null; render()" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-medium hover:bg-gray-700">
                            Ny validering
                        </button>
                    </div>
                </div>
                ` : ''}
            `;

            // Event listeners f√∂r inputs
            ['length','width','height','type','hasRopes','hasNetting','nettingMesh','nettingCorners','blowersNeeded',
             'blowerPower','anchorA','anchorB','anchorC','anchorD','anchorAngle','productId','idVisible'].forEach(f => {
                const el = document.getElementById(f);
                if (el) el.addEventListener('change', e => { app.data[f] = e.target.value; render(); });
            });

            const cb = document.getElementById('hasSafetyInstructions');
            if (cb) cb.addEventListener('change', e => { app.data.hasSafetyInstructions = e.target.checked; });

            // Bilduppladdning
            const imgInput = document.getElementById('imageInput');
            if (imgInput) {
                imgInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) addImage(file);
                });
            }
        }

        const saved = localStorage.getItem('hoppborg');
        if (saved) {
            const parsed = JSON.parse(saved);
            app.data = parsed.data || app.data;
        }
        render();
    </script>
</body>
</html>
